#!/usr/bin/env rake

#require 'rake/clean'
#CLOBBER.include("foodcritic")
#task "cheftest" => ["init", "compile"]

BASE_DIR = File.dirname(__FILE__)
TARGET_COOKBOOKS_NAME = [ "rbenv", "test_recipe" ]

desc "Runs foodcritic linter"
task :foodcritic do |t|
  puts "-- #{t.name} running -- "
  if Gem::Version.new("1.9.2") <= Gem::Version.new(RUBY_VERSION.dup)

    TARGET_COOKBOOKS_NAME.each do |cookbook|
      file_path = File.join(BASE_DIR, cookbook)
      sh "foodcritic --epic-fail any #{file_path}"
    end

  else
    puts "WARN: foodcritic run is skipped as Ruby #{RUBY_VERSION} is < 1.9.2."
  end
end


desc "chefspec to target cookbooks"
task :rspec do |t|
  puts "-- #{t.name} running -- "
  if Gem::Version.new("1.9.2") <= Gem::Version.new(RUBY_VERSION.dup)
    require 'rspec/core/rake_task'
    RSpec::Core::RakeTask.new(:rspec) do |t|
      t.pattern = 'cookbooks/{rbenv,test_recipe}/spec/*_spec.rb'
      t.rspec_opts = ['-c']
    end
  end
end

task :default => [:foodcritic, :rspec]
